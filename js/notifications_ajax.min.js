(function(o,t){function n(e){var s=this,c=t('<div />'),a=t('<div />'),r=null;this.options=t.extend({},n.default,e);this.showNotification=function(i,e,a,n){c.queue(function(){var r=this;setTimeout(function(){t(r).dequeue()},100);var c=new Notification(e,{body:a,icon:s.options.icon});if(typeof(n)!='undefined'&&n!=null){c.url_item=CFG_GLPI.url_base+'/'+(n);c.onclick=function(i){i.preventDefault();o.open(this.url_item,'_blank')}};t.ajax({url:CFG_GLPI.root_doc+'/ajax/notifications_ajax.php',method:'GET',data:{delete:i}})})};this.playAudio=function(i){if(!i||!('Audio' in o)){return!1};var n=new Audio();t(n).append(t('<source />',{src:CFG_GLPI.root_doc+'/sound/'+i+'.mp3',type:'audio/mpeg'}));t(n).append(t('<source />',{src:CFG_GLPI.root_doc+'/sound/'+i+'.ogg',type:'audio/ogg'}));a.queue(function(){var i=this;n.onended=function(){t(i).dequeue()};n.play()})};this.checkNewNotifications=function(){if(!s.isSupported()){return!1};var o=t.getJSON(CFG_GLPI.root_doc+'/ajax/notifications_ajax.php');o.done(function(t){if(t){for(i=0;i<t.length;i++){var o=t[i];s.showNotification(o.id,o.title,o.body,o.url)};if(s.options.sound){s.playAudio(s.options.sound)}}})};this.checkConcurrence=function(){var o='glpi_ajaxnotification_lastcheck_'+this.options.user_id,i=localStorage.getItem(o);if(!i){i=0};var t=new Date().getTime();if(i<=t-this.options.interval+50){localStorage.setItem(o,t);this.checkNewNotifications()}};this.startMonitoring=function(){this.checkConcurrence();r=setInterval(this.checkConcurrence.bind(this),this.options.interval)};this.checkPermission=function(){if(Notification.permission==='granted'){this.startMonitoring()}
else if(Notification.permission!=='denied'){Notification.requestPermission(function(i){if(i==='granted'){this.startMonitoring()}})}};this.start=function(){if(!this.isSupported()){return!1};this.checkPermission()};this.isSupported=function(){return'Notification' in o&&'localStorage' in o}};n.default={interval:10000,sound:!1,icon:!1,user_id:0};o.GLPINotificationsAjax=n})(window,jQuery);